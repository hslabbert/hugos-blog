<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Troubleshooting on Hugo&#39;s Blog</title>
    <link>https://bamboo.slabnet.com/~hslabbert/blog/categories/troubleshooting/</link>
    <description>Recent content in Troubleshooting on Hugo&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <managingEditor>hugo@slabnet.com (Hugo Slabbert)</managingEditor>
    <webMaster>hugo@slabnet.com (Hugo Slabbert)</webMaster>
    <copyright>&amp;copy; 2016 Hugo Slabbert</copyright>
    <lastBuildDate>Wed, 11 Feb 2009 16:24:50 +0000</lastBuildDate>
    <atom:link href="https://bamboo.slabnet.com/~hslabbert/blog/categories/troubleshooting/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Cannot install ESET Security on Debian 4.0 Etch Virtuozzo VPS</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/cannot-install-eset-security-on-debian-40-etch-virtuozzo-vps/</link>
      <pubDate>Wed, 11 Feb 2009 16:24:50 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/cannot-install-eset-security-on-debian-40-etch-virtuozzo-vps/</guid>
      <description>&lt;p&gt;As part of some mail filter testing, I needed to install ESET Mail Security onto a Debian 4.0 Etch VPS running on Virtuozzo. As a side-note, I found that the install package for ESET’s Gateway Filter, Mail Security, and File Server Security for Linux is all the exact same package; the functionality is basically just controlled/activated by means of licensing the appropriate component.&lt;/p&gt;

&lt;p&gt;Anyway, the download comes as an installation script called &lt;code&gt;esets.i386.deb.bin&lt;/code&gt;. Running that script outputs a license agreement that you have to accept, produces a .deb package called &lt;code&gt;esets.i386.deb&lt;/code&gt;, and outputs instructions on how to install the .deb package by using dpkg and import the license file. The .deb package installed just fine on another Debian test box, but when I attempted to run &lt;code&gt;dpkg –i esets.i386.deb&lt;/code&gt; on the Virtuozzo VPS, tar squawked at me that it could not open &lt;code&gt;/dev/stdin&lt;/code&gt; and the installation bailed:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;hostname:/usr/local/src/eset# dpkg -i esets-3.0.11.i386.deb
Selecting previously deselected package esets.
(Reading database ... 24639 files and directories currently installed.)
Unpacking esets (from esets-3.0.11.i386.deb) ...
Setting up esets (3.0.11) ...
Unpacking esets modules ...
tar: /dev/stdin: Cannot open: No such file or directory
tar: Error is not recoverable: exiting now
dpkg: error processing esets (--install):
subprocess post-installation script returned error exit status 2
Errors were encountered while processing:
esets
&lt;/code&gt;&lt;/pre&gt;

&lt;!-- more --&gt;

&lt;p&gt;To which I replied, “huh?”&lt;/p&gt;

&lt;p&gt;I took a peek around /dev (&lt;code&gt;ls /dev&lt;/code&gt;), and wouldn’t you know it? No stdin, no stdout, and no stderr! Say what? I checked around ESET’s KB’s, but found nothing related to the issue. I poked around Virtuozzo’s and OpenVZ’s wiki’s, but again came up empty. I checked out the /dev directory (&lt;code&gt;ls –l /dev/&lt;/code&gt;) on my test box on which I had successfully installed the package, and, as expected, /dev/stdin, /dev/stdout, and /dev/stderr were there. Looking more closely, we see that those files are links to a set of files at /proc/self/fd.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;hostname:~# ls -l /dev/std*
lrwxrwxrwx 1 root root 15 2009-01-28 02:35 /dev/stderr -&amp;gt; /proc/self/fd/2
lrwxrwxrwx 1 root root 15 2009-01-28 02:35 /dev/stdin -&amp;gt; /proc/self/fd/0
lrwxrwxrwx 1 root root 15 2009-01-28 02:35 /dev/stdout -&amp;gt; /proc/self/fd/1
hostname:~# 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So, on my Debian Virtuozzo VPS, I did the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ln -s /proc/self/fd/0 /dev/stdin
ln -s /proc/self/fd/1 /dev/stdout
ln -s /proc/self/fd/2 /dev/stderr 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I re-ran the package installation, and we were set! I don’t know if this issue is particular to some .deb packages or to all, as I had only used &lt;code&gt;apt-get&lt;/code&gt; up to that point for package installation. As of now, though, I have not yet had any issues with the package or with the links I created…at least not as far as I can tell!&lt;/p&gt;

&lt;p&gt;Let me know if you have any other info on this issue.&lt;/p&gt;

&lt;p&gt;Bitcoin tip address for this post:
&lt;a href=&#34;bitcoin:1PncfTJjuzybqSDcZrP8qJSApHgtZp5B7F&#34;&gt;1PncfTJjuzybqSDcZrP8qJSApHgtZp5B7F&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>“550 4.4.7 QUEUE.Expired; message expired” when emailing mail-enabled Public folder</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/550-447-queueexpired-message-expired-when-emailing-mail-enabled-public-folder/</link>
      <pubDate>Wed, 11 Feb 2009 16:24:25 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/550-447-queueexpired-message-expired-when-emailing-mail-enabled-public-folder/</guid>
      <description>&lt;p&gt;We’ve been working on some major upgrades to our Exchange environment over the last while. During the course of that, we started receiving NDR’s for messages sent to mail-enabled public folders. Initially, these were “MapiExceptionNotAuthorized” messages, which are related to permissions. Those were sorted out without too much trouble, as the NDR is at least somewhat descriptive. But then we started receiving a very generic NDR of &lt;code&gt;#550 4.4.7 QUEUE.Expired; message expired ##&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&amp;hellip;not really much to go on. Exchange 2007 does give some more “in plain English, please!” information in its NDR’s, but that also wasn’t much help:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;Delivery has failed to these recipients or distribution lists:&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[user display name]
Microsoft Exchange has been trying to deliver this message without success
and has stopped trying. Please try sending this message again, or provide
the following diagnostic text to your system administrator.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Wow&amp;hellip;that was helpful&amp;hellip;&lt;/p&gt;

&lt;p&gt;After &lt;em&gt;much&lt;/em&gt; digging, I found that the problem stemmed from a public folders server that had been retired. It was going to be re-purposed as an SCR target server, but for now was offline. The trouble was that for the Public Folder tree to which the mail-enabled folder belonged was “owned” by this offline server. This “ownership” is found in the &lt;code&gt;msExchOwningPFTreeBL&lt;/code&gt;attribute of the public folder store in question. This property is accessible through ADSIEDIT. Now, MS articles to do with this state that the &lt;code&gt;msExchOwningPFTreeBL&lt;/code&gt; attribute is not directly editable, but you &lt;em&gt;can&lt;/em&gt; edit or remove the &lt;code&gt;msExchOwningPFTree&lt;/code&gt; attribute, which effectively updates the &lt;code&gt;msExchOwningPFTreeBL&lt;/code&gt; attribute (ref &lt;a href=&#34;http://technet.microsoft.com/en-us/library/aa996228.aspx&#34;&gt;Public Folder Routing&lt;/a&gt; - Technet). I can’t remember if that’s accurate or not, as this happened some time ago, but at this point I only see the &lt;code&gt;msExchOwningPFTreeBL&lt;/code&gt; attribute on our PF store, and not the &lt;code&gt;msExchOwningPFTree&lt;/code&gt; attribute.&lt;/p&gt;

&lt;p&gt;For reference, these attributes are on your PF store, which should be located in the Configuration container in ADSIEDIT (&lt;code&gt;CN=Configuration,DC=yourdomain,DC=[yourtld]&lt;/code&gt;). The full path is:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;CN=Public Folders,CN=Folder Hierarchies,CN=[Your Exchange Administrative Group Name],CN=Administrative Groups,CN=[Your Exchange Organization Name],CN=Microsoft Exchange,CN=Services,CN=Configuration,DC=[yourdomain],DC=[yourtld].
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;After updating the &lt;strong&gt;msExchOwningPFTree&lt;/strong&gt; attribute appropriately to a public folders server that was in production resolved the issue.&lt;/p&gt;

&lt;p&gt;Bitcoin tip address for this post:
&lt;a href=&#34;bitcoin:16KvZ8hMCNTBhhz9KGZ7MKeW3N1WayaYxR&#34;&gt;16KvZ8hMCNTBhhz9KGZ7MKeW3N1WayaYxR&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Windows Media Player 11 Breaks Internet Connectivity</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/windows-media-player-11-breaks-internet-connectivity/</link>
      <pubDate>Wed, 13 Aug 2008 06:18:52 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/windows-media-player-11-breaks-internet-connectivity/</guid>
      <description>&lt;p&gt;Alright, so the title for this post seems pretty out there, but I can guarantee you that I have come across this on multiple machines. I&amp;rsquo;m not saying &amp;ldquo;If you install Windows Media Player 11 on your computer, networking will break,&amp;rdquo; I&amp;rsquo;m just saying that if you experience the symptoms outlined below and you&amp;rsquo;re stuck, trying uninstalling WM11 and the WM11 codec; you just might get lucky.&lt;/p&gt;

&lt;p&gt;So, one of the other techs in the office calls me over: He&amp;rsquo;s been beating his head against a wall with a remote user being unable to get internet connectivity on his Windows XP workstation. The tech has been on this thing for hours, tried just about everything he can think of shy of a workstation rebuild, and he&amp;rsquo;s looking for some team support. I have him throw the ticket my way; I figure that another set of eyes can only be helpful. With a bit of digging, we isolate the symptoms:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Full connectivity to the local server is available&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Name resolution is still solid&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Pings are working to both local and remote addresses&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Anything higher up the stack than pings only work locally, and bail as soon as you cross a router. This includes file shares, RDP, FTP, HTTP/s, MAPI, and I&amp;rsquo;m guessing anything else higher than layer 4.&lt;!-- more --&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;About an hour or so later, I&amp;rsquo;m still not much farther than tech #1. I&amp;rsquo;ve reset the stack (&lt;code&gt;netsh winsock reset&lt;/code&gt;) and rebooted, updated/reinstalled the network card drivers&amp;hellip;heck, we even flashed the BIOS on the thing. Nothing&amp;hellip;zip&amp;hellip;nada.&lt;/p&gt;

&lt;p&gt;So, I start thinking that maybe some weird malware/adware that&amp;rsquo;s intercepting traffic and messing things up. I head to Add/Remove Programs and start flipping through the titles. Nothing nasty stands out, but I remove the IE toolbars just to be safe as I&amp;rsquo;ve had some personal experience with Yahoo! toolbars causing crashes and other wonderful things in IE. Still no joy&amp;hellip;&lt;/p&gt;

&lt;p&gt;I get to the end of the list and see an entry for &lt;strong&gt;Windows Media Player 11 codec&lt;/strong&gt;. Now, fortunate for me, I don&amp;rsquo;t play around with WM much, and so I&amp;rsquo;m not sure if this is a legit piece of software or not. What I do remember is a particularly nasty experience I had with some malware hiding in the Add/Remove Programs list as media players. So, out goes the codec. Just for good measure, I toss Windows Media Player 11 after the reboot and then reboot the box again. Why? To be honest, I really don&amp;rsquo;t know&amp;hellip;I was getting pretty low on bright ideas at that point.&lt;/p&gt;

&lt;p&gt;And then, magically, internet connectivity is restored. I still don&amp;rsquo;t have an explanation for this, but for some reason, Windows Media Player 11 being installed on that machine (and at least two others so far in my experience!) caused Layer 5+ routed networking to bail. If you have a KB or something that explains this, please let me know, &amp;lsquo;cause that&amp;rsquo;s just messed up!&lt;/p&gt;

&lt;p&gt;Anyhow: Happy hunting!&lt;/p&gt;

&lt;p&gt;JaS&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SSL Errors in Exchange 2003 Public Folder Management</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/ssl-errors-in-exchange-2003-public-folder-management/</link>
      <pubDate>Wed, 13 Aug 2008 05:51:47 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/ssl-errors-in-exchange-2003-public-folder-management/</guid>
      <description>&lt;p&gt;On a recent network audit for a prospective new client, I came across an issue in the Exchange System Manager for their Exchange Server 2003 box. When you tried to browse into any public folder management, ESM presented the following error:&lt;/p&gt;

&lt;p&gt;The SSL certificate server name is incorrect.&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;I checked the certificate, and it was definitely valid with a trusted Root CA. A quick web search pointed me to &lt;a href=&#34;http://support.microsoft.com/kb/324345&#34;&gt;this&lt;/a&gt; Microsoft KB. The gist is that whoever set up the Exchange server had set SSL to be required on the \Exadmin virtual directory in the default site on the server. The solution: Clear SSL for the Exadmin vdir and relaunch ESM.&lt;/p&gt;

&lt;p&gt;This one is fairly straightforward and seems to be fairly common, but I thought I would throw it up here all the same as I had not really come across it in recent memory.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;JaS&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Exchange 2007: Messages stuck in Submission Queue</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/exchange-2007-messages-stuck-in-submission-queue/</link>
      <pubDate>Wed, 13 Aug 2008 04:32:24 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/exchange-2007-messages-stuck-in-submission-queue/</guid>
      <description>&lt;p&gt;We recently received reports of message delivery delays in our Exchange organization. We run Exchange 2007, so I checked out the Hub Transport Servers and discovered that messages were piling up in the &lt;strong&gt;Submission&lt;/strong&gt; queues on both of the main hub transports. Restarting the Microsoft Exchange Transport service didn&amp;rsquo;t get things going again, so I turned to the Application Log to try to figure out what was going on.&lt;!-- more --&gt;&lt;/p&gt;

&lt;p&gt;I noticed some errors coming from the source &lt;strong&gt;MSExchange Extensibility&lt;/strong&gt;, with an event ID of 1050. They read as follows:&lt;/p&gt;

&lt;blockquote&gt;The execution time of agent &#39;ScanMail Routing Agent&#39; exceeded 300000 (milliseconds) while handling event &#39;OnSubmittedMessage&#39;. This is an unusual amount of time for an agent to process a single event. However, Transport will continue processing this message.&lt;/blockquote&gt;

&lt;p&gt;From the event, you can tell we&amp;rsquo;re using TrendMicro ScanMail as part of our edge protection. It looked like the ScanMail scanning agent was stuck on a message and couldn&amp;rsquo;t proceed. So, off to the services console I go. ScanMail has three services installed on the server, including its Master Service. The other services seemed happy, but the Master service timed out when I attempted to stop it. I checked the service properties and found its related executable file and killed it through Task Manager. The service was then recorded in the Services Console as being stopped, and after starting the service, mail started flowing again on that Hub Transport server. I repeated those steps on the second Hub Transport server, and messages came flooding out from there as well.&lt;/p&gt;

&lt;p&gt;I checked that ScanMail was up to date on both servers, and they appeared to be. I checked through Trend Micro&amp;rsquo;s site nonetheless, and found that there appeared to be a related update. The links:&lt;/p&gt;

&lt;p&gt;List of updates for ScanMail 8:  &lt;a href=&#34;http://www.trendmicro.com/download/product.asp?productid=8&#34;&gt;http://www.trendmicro.com/download/product.asp?productid=8&lt;/a&gt;
Direct link to the relevant update:  &lt;a href=&#34;http://www.trendmicro.com/ftp/products/patches/smex_80_win_en_patch3.exe&#34;&gt;ScanMail 8.0 for Microsoft Exchange Patch 3&lt;/a&gt;
The README file:  &lt;a href=&#34;http://www.trendmicro.com/ftp/documentation/readme/smex_80_win_en_patch3_Readme.TXT&#34;&gt;http://www.trendmicro.com/ftp/documentation/readme/smex_80_win_en_patch3_Readme.TXT&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The relevant portion of the changelog:&lt;/p&gt;

&lt;blockquote&gt;21. While ScanMail for Microsoft Exchange 8.0 is running, after a few hours, email messages will start to queue. If user re-starts the ScanMail for Microsoft Exchange services, the application will hang at &#34;Stopping&#34;.&lt;/blockquote&gt;

&lt;p&gt;I was technically on vacation while this all went down, so I had to hand of the update to someone else to apply, but no one was available for that weekend. The patch was not manually applied on the servers that weekend, but the issue did not return. We&amp;rsquo;ve now been running smoothly for about two weeks.&lt;/p&gt;

&lt;p&gt;Hopefully you don&amp;rsquo;t run across the issue, and hopefully this post will be of some help if you do!&lt;/p&gt;

&lt;p&gt;Bitcoin tip address for this post: 1HC44rd1NUZUiWDsHNf9Y1KPSxbtW7b5Sw&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Vista Offline Files and SMB Opportunistic Locks</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/vista-offline-files-and-smb-opportunistic-locks/</link>
      <pubDate>Sun, 30 Mar 2008 19:12:52 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/vista-offline-files-and-smb-opportunistic-locks/</guid>
      <description>&lt;p&gt;One of our techs recently ran across a problem with a new Windows Vista Business laptop trying to synchronize offline files to a Windows Server 2000 file server. Synchronization would start, but the Sync Center in Vista would show failures for every single file that was attempted to be sync&amp;rsquo;d. The error message read something to the extent of &amp;ldquo;&lt;em&gt;The process cannot access the file because it is being used by another process&lt;/em&gt;&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;We tried the usual: checking permissions on the folders being offline&amp;rsquo;d (I know that&amp;rsquo;s probably not a word, but you get what I mean); deleting his local cache of Offline Files; disabling and then re-enabling Offline Files. But we just kept on banging our heads against the same error. At first, just about any web search for the error resulted in either something about Windows Home Server or databases or something of the like.  Eventually, though, we struck gold:&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://support.microsoft.com/kb/296264/en-us&#34;&gt;http://support.microsoft.com/kb/296264/en-us&lt;/a&gt;: Configuring opportunistic locking in Windows&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;According to MS, opportunistic locking &amp;ldquo;&lt;em&gt;lets clients lock        files and locally cache information without the risk of another user changing           the file&lt;/em&gt;&amp;rdquo;. Opportunistic Locking is a feature of SMB. It is enabled by default, and is configurable from the client side (i.e. request opportunistic locking or not) and on the server side (i.e. allow opportunistic locking on local files or not).&lt;/p&gt;

&lt;p&gt;Also note: &amp;ldquo;&lt;em&gt;If you disable opportunistic locking, the offline files feature in Windows           Vista fails&lt;/em&gt;&amp;ldquo;&lt;/p&gt;

&lt;p&gt;So, apparently, &amp;ldquo;_The process cannot access the file because it is being used by another process&amp;rdquo; &lt;em&gt;actually means&lt;/em&gt; &amp;ldquo;Opportunistic locking is not enabled on the file server_&amp;ldquo;. Nice&amp;hellip;&lt;/p&gt;

&lt;p&gt;Be aware that this setting is changed through the registry, so the regular warnings about messing about in REGEDIT apply (read &lt;a href=&#34;http://bamboo.slabnet.com/~hslabbert/blog/disclaimer/&#34;&gt;Disclaimer&lt;/a&gt;). That stuff is already listed in the KB, so I won&amp;rsquo;t bother to repeat it.&lt;/p&gt;

&lt;p&gt;To enable opportunistic locking on the file server, open REGEDIT to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters, and change the value of the REG_DWORD
&lt;strong&gt;EnableOplocks&lt;/strong&gt; from 0 to 1.&lt;/p&gt;

&lt;p&gt;The server does need to be rebooted in order for the registry change to take effect. After rebooting, retry your offline files synchronization. If the opportunistic locking was your problem, you should be good to go!&lt;/p&gt;

&lt;p&gt;UPDATE:&lt;/p&gt;

&lt;p&gt;I must also thank Rainier Day for &lt;a href=&#34;http://blog.rainiernetworks.com/2008/06/25/vista-synchronization-errors/&#34;&gt;his post&lt;/a&gt; on his struggles with Opportunistic Locking. He was hit from the other side: The server-side opslock settings were good, but his Vista clients were configured to &lt;em&gt;not&lt;/em&gt; request opportunistic locks, and this caused the clients to also experience offline files synchronization errors. Thanks Ranier: I noticed that component in the MS KB, but had never actually come across a Vista workstation that was configured out-of-the-box to have OpsLocks disabled!&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;JaS&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Find Disabled and Inactive User and Computer Accounts using Powershell - Part I</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/find-disabled-and-inactive-user-and-computer-accounts-using-powershell-part1/</link>
      <pubDate>Tue, 25 Mar 2008 05:28:15 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/find-disabled-and-inactive-user-and-computer-accounts-using-powershell-part1/</guid>
      <description>&lt;p&gt;We&amp;rsquo;ll start off with Inactive accounts first, and then work on the disabled accounts after that.&lt;/p&gt;

&lt;p&gt;Active Directory in Server 2003 has a nice user/computer attribute called lastLogonTimeStamp that can help us keep track of inactive accounts. If you have ever tried to use that attribute, however, you might have come up with something like this&amp;hellip;&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt; $struserdn = &amp;quot;CN=Some User,OU=Users,OU=Corp,DC=yourdomain,DC=local&amp;quot;
PoSH&amp;gt; $adobjuser = [ADSI]&amp;quot;LDAP://$struserdn&amp;quot;
PoSH&amp;gt; $adobjuser
{CN=Some User,OU=Users,OU=Corp,DC=yourdomain,DC=local}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt; $adobjuser.lastLogonTimetamp&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;What the &amp;hellip;? Hmm&amp;hellip;I&amp;rsquo;m sure I saw lastLogonTimestamp in the members for that object before:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt;$adobjuser | Get-Member&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;TypeName: System.DirectoryServices.DirectoryEntry
...
lastLogonTimestamp              Property   System.DirectoryServices.PropertyValueCollection lastLogonTimestamp {get;...
...
&lt;/code&gt;
&lt;code&gt;PoSH&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Right,  like I said! Then why doesn&amp;rsquo;t it give me any information for that property? May it&amp;rsquo;s blank? Highly unlikely, but let&amp;rsquo;s check:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt; $adobjuser | Format-List *
...
lastLogonTimestamp              : {System.__ComObject}
...&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;PoSH&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Great! What do I do with that thing? To be honest, working with ComObjects is not really my thing, but we still can get the information we want. For my purposes, I was searching through AD with a DirectorySearcher anyway, and the answer to my problems came from DirectorySearcher in the end. First, the code (credit to &lt;a href=&#34;http://blogs.technet.com/bahramr/archive/2008/01/25/powershell-script-to-disable-inactive-accounts-in-active-directory.aspx&#34;&gt;Bahram&amp;rsquo;s Blog&lt;/a&gt;), and then we&amp;rsquo;ll run through what we&amp;rsquo;re actually doing.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$currentDate = [System.DateTime]::Now
$currentDateUtc = $currentDate.ToUniversalTime()
&lt;/code&gt;&lt;code&gt;$lltstamplimit = $currentDateUtc.AddDays(- $NumDays)
$lltIntLimit = $lltstampLimit.ToFileTime()
$adobjroot = [adsi]&#39;&#39;
&lt;/code&gt;&lt;code&gt;$objstalesearcher = New-Object System.DirectoryServices.DirectorySearcher($adobjroot)
&lt;/code&gt;&lt;code&gt;$objstalesearcher.filter = &amp;quot;(&amp;amp;(objectCategory=person)(objectClass=user)(lastLogonTimeStamp&amp;lt;=&amp;quot; + $lltIntLimit + &amp;quot;))&amp;quot;
&lt;/code&gt;&lt;code&gt;$resultstaleaccn = $objstalesearcher.findall() | sort path&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Alright, so before we get going, this snippet of code requires that we define an Int32 variable called &lt;code&gt;$numdays&lt;/code&gt; before we run it. This will be used as the number of days since the account last logged on. So what exactly is going on here? The easiest way to both get a proper DateTime object and get a relative time for setting the period for inactive accounts is to get the current date and time:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$currentDate = [System.DateTime]::Now&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;As far as I can see, you could also use &lt;code&gt;$currentdate = Get-Time&lt;/code&gt; , so it&amp;rsquo;s your choice, really.&lt;/p&gt;

&lt;p&gt;Active Directory stores times in UTC format, so we can use the ToUniversalTime() method available on the System.DateTime class:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$currentDateUtc = $currentDate.ToUniversalTime()&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This is where the &lt;code&gt;$numdays&lt;/code&gt; variable comes in. Let&amp;rsquo;s say your organization has a policy in effect that accounts that have been inactive for 60 must be disabled. If the lastLogonTimeStamp attribute is 60 days less than the current Date/Time, then we know that account has not been logged onto for the last 60 days. So, we will want to search for accounts that have a value 60 days less than today in their lastLogonTimeStamp attribute. To make that reference point, we can do some simple math:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$lltstamplimit = $currentDateUtc.AddDays(- $NumDays)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This assumes that we have run &lt;code&gt;$NumDays = 60&lt;/code&gt; somewhere before this last command, and effectively saves our last logon time stamp limit ($lltstamplimit) as a System.DateTime value 60 days before now.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$lltIntLimit = $lltstampLimit.ToFileTime()&lt;/code&gt; converts the &lt;code&gt;$lltstamplimit&lt;/code&gt; to an Int64 value. Why? You&amp;rsquo;ve got me! Please let me know if you have the goods on this, because I&amp;rsquo;m still blissfully unaware of the purpose/function of Int64 values.&lt;/p&gt;

&lt;p&gt;The rest is fairly straight-forward. We set up a directory searcher and define the filter as a user object the lastLogonTimeStamp less than the limit we defined in &lt;code&gt;$lltIntLimit&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$adobjroot = [adsi]&#39;&#39;
$objstalesearcher = New-Object System.DirectoryServices.DirectorySearcher($adobjroot)
$objstalesearcher.filter = &amp;quot;(&amp;amp;(objectCategory=person)(objectClass=user)(lastLogonTimeStamp&amp;lt;=&amp;quot; + $lltIntLimit + &amp;quot;))&amp;quot;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;In the name of tidiness and efficiency, I would recommend restricting the search root to your user containers with something like &lt;code&gt;$objstalesearcher.searchroot = &amp;quot;LDAP://$searchrootdn&amp;quot;&lt;/code&gt; where $searchrootdn is a distinguished name as a string.&lt;/p&gt;

&lt;p&gt;All that remains at that point is to collect the results:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;$resultstaleaccn = $objstalesearcher.findall() | sort path&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;For my own purposes I sort the results by their LDAP path, but you obviously don&amp;rsquo;t have to. Remember that your result will be saved as a System.DirectoryServices.SearchResult object, so you will probably have to use &lt;code&gt;$_.Properties.[SomeProperty]&lt;/code&gt; to get the information you&amp;rsquo;re looking for.  From there, you can do with the results as you please.&lt;/p&gt;

&lt;p&gt;Oh, and if you&amp;rsquo;re looking for inactive computer  accounts instead of user accounts, switch both the objectCategory and objectClass values in your DS searcher filter to &lt;em&gt;computer.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;To learn how to find &lt;em&gt;disabled&lt;/em&gt; accounts rather than inactive ones, head over to Part II.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Dell, Broadcom, Server 2003 SP2 SNP and TOE</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/dell-broadcom-server-2003-sp2-snp-and-toe/</link>
      <pubDate>Sun, 23 Mar 2008 04:03:02 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/dell-broadcom-server-2003-sp2-snp-and-toe/</guid>
      <description>&lt;p&gt;Dell, Broadcom, and Microsoft have decided to partner up with the release of a technology called TCP/IP Offloading, or TOE for &lt;em&gt;TCP/IP Offload Engine&lt;/em&gt;. It was bundled together in the Scalable Network Pack (SNP), included and enabled by default with Service Pack 2 (SP2) for Windows Server 2003. The gist of this technology is to enable high-load enterprise applications to be easily scalable. For those of you familiar with the OSI model, TOE moves layer 3 and 4 processing out of the OS and CPU into the NIC. The idea is to better utilize advances in network card performance and free up CPU cycles for other purposes, such as application-side processing.&lt;/p&gt;

&lt;p&gt;This all seems well and good, if they saw fit to properly test the stuff out against their own applications!&lt;/p&gt;

&lt;!-- more --&gt;

&lt;p&gt;It started with a few calls: users would get a &lt;em&gt;&lt;strong&gt;Waiting to Update this Folder&lt;/strong&gt;&lt;/em&gt; message in their Outlook client that did not go away even after several hours, but Outlook still showed as &lt;em&gt;&lt;strong&gt;Connected to Microsoft Exchange&lt;/strong&gt;&lt;/em&gt;. Except this was not just for a few users; every single user on a particular Exchange 2007 mailbox server would be affected&amp;hellip;not cool when more than 300 mailboxes from multiple different clients are affected!&lt;/p&gt;

&lt;p&gt;Restart system attendant on mailbox server? No joy. Restart  WWW and SSL services on Client Access Server? Wrong again. Restart every freakin&amp;rsquo; Exchange service on the mailbox and Client Access Server? Still no positive change. Fine! Get the go-ahead and restart the mailbox server? Bingo.&lt;/p&gt;

&lt;p&gt;That,  however, is not what we call a &lt;em&gt;resolution&lt;/em&gt;. At best that&amp;rsquo;s a workaround, but a workaround that comes with guaranteed downtime, and no explanation as to the cause. So we checked the event viewers on the mailbox server and the client access servers, and found&amp;hellip;nothing&amp;hellip;damn&amp;hellip; Run the Best Practice Analyzer for Exchange&amp;hellip;nothing useful&amp;hellip;damn again&amp;hellip; Whatever, chalk it up to freaky coincidences and keep going. That was fine, until it happened again, and again, and again, all with no trace.&lt;/p&gt;

&lt;p&gt;Alright, so a call to MS Support it is. Four hours on the phone later, and no real answers. The tech suggests that we &lt;a href=&#34;http://support.microsoft.com/kb/912222&#34;&gt;disable TCP/IP Chimney&lt;/a&gt;, one of the features of the TCP/IP Offloading technology, and we comply. As is to be expected, the support guys wanted to try and pin it on an Outlook issue, as that is where the problem was most visible. But that just doesn&amp;rsquo;t fly when every single client on a particular mailbox server is affected at the exact same time. Anyway, they tell us that they will keep checking on it, but that we will have to call them back when the problem is occurring and &lt;em&gt;before&lt;/em&gt; we reboot the affected mailbox server. Okay&amp;hellip;well&amp;hellip;tell that to the 300+ users screaming for email access they are paying for!&lt;/p&gt;

&lt;p&gt;The next time the problem rolls around, I try to get the okay to call MS, but the clients have already had too many email headaches from this problem, and we&amp;rsquo;re forced to reboot the box again to keep people happy. Fortunately, MS gets a higher-up tech in touch with us, and the guy drills us with some useful questions for relevant information. He starts to run through the BPA stuff again and gets us to export the event logs and upload them for further examination. He requests that we download a specific Exchange troubleshooting tool, and upload the logs for that as well. Now we&amp;rsquo;re getting somewhere! Or so I thought.&lt;/p&gt;

&lt;p&gt;The mailbox servers that were affected get through the majority of the tests and information gathering of the tool they had us download, but it bails on some RPC-related diagnostics. I report this to the tech, so he directs us to use a different tool that skips around that part. After some scheduled reboots, the original tool completes its diagnostics, and we can upload the results. At this point, we can&amp;rsquo;t afford more problems, so we&amp;rsquo;re actually running _nightly _reboots on the Exchange mailbox and CAS servers. This seems to stave off the problem, but, again, this is just a workaround.&lt;/p&gt;

&lt;p&gt;The tech finds nothing in the event viewer to indicate any problems, but he suggests the TCP/IP Chimney disable thing again. This time, however, we also are told to disable any offloading features in the network card device configuration as well. I find the settings and switch them off. We had consolidated mailboxes so that one of the mailbox servers remains with only a few test mailboxes and the mailboxes of some of our support team members on it. It&amp;rsquo;s a gamble, but we remove nightly reboots from that server and switch back to the regular reboot schedule. Weeks pass, and we don&amp;rsquo;t run into any problems. We load some more mailboxes on there, and still no problems.&lt;/p&gt;

&lt;p&gt;So, after weeks and weeks of reliability problems, the sneaky culprit was a set of technologies teamed together as the Scalable Network Pack (SNP), introduced without much notice with SP2 for Server 2003. I ended up writing a VB script that determines if a server is running with Broadcom network cards and disables the TOE settings in the TCP/IP stack directly as well as the TOE and SNP settings on the network cards themselves through some registry edits.&lt;/p&gt;

&lt;p&gt;I later found that the MSExchange team had posted a &lt;a href=&#34;http://msexchangeteam.com/archive/2007/07/18/446400.aspx&#34;&gt;blog entry&lt;/a&gt; about potential problems with TOE and Exchange 2007, but had for some reason never come across this post in my searches on the symptoms we were experiencing. I have also since run into posts from other sysadmins reporting that the TOE features cause Internet Security and Acceleration (ISA) Server to lock up completely.&lt;/p&gt;

&lt;p&gt;I would post the VB script I created for dealing with this problem, but Microsoft also just released a &lt;a href=&#34;http://support.microsoft.com/kb/948496&#34;&gt;hotfix&lt;/a&gt; that specifically disables the SNP features. Here is a list of some of the problems the hotfix is meant to address:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;When you try to connect to the server by using a VPN connection, you receive the following error message: Error 800: Unable to establish connection.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You cannot create a Remote Desktop Protocol (RDP) connection to the server.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You cannot connect to shares on the server from a computer on the local area network.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You cannot join a client computer to the domain.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You cannot connect to the Exchange server from a computer that is running Microsoft Outlook.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Inactive Outlook connections to the Exchange server may not be cleaned up.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You experience slow network performance.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You may experience slow network performance when you communicate with a Windows Vista-based computer.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You cannot create an outgoing FTP connection from the server.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The Dynamic Host Configuration Protocol (DHCP) server service crashes.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You experience slow performance when you log on to the domain.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Network Address Translation (NAT) clients that are located behind Windows Small Business Server 2003 or Internet Security and Acceleration (ISA) Server experience intermittent connection failures.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;You experience intermittent RPC communications failures.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The server stops responding.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;The server runs low on nonpaged pool memory&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&amp;hellip;wow&amp;hellip;so pretty much, this &lt;em&gt;Microsoft&lt;/em&gt; technology that is turned on &lt;em&gt;by default&lt;/em&gt; breaks several &lt;em&gt;Microsoft&lt;/em&gt; server products and messes networking almost entirely. Nice&amp;hellip;&lt;/p&gt;

&lt;p&gt;I hope that this spares somebody some of the pain we had to go through with this.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Ultimate Guide to Linux Boot Problems</title>
      <link>https://bamboo.slabnet.com/~hslabbert/blog/post/ultimate-guide-to-linux-boot-problems/</link>
      <pubDate>Wed, 16 Jan 2008 18:41:02 +0000</pubDate>
      <author>hugo@slabnet.com (Hugo Slabbert)</author>
      <guid>https://bamboo.slabnet.com/~hslabbert/blog/post/ultimate-guide-to-linux-boot-problems/</guid>
      <description>&lt;p&gt;I haven&amp;rsquo;t played around much in Linux lately, but I finally dusted off my &lt;a href=&#34;http://www.ubuntu.com/&#34;&gt;Ubuntu&lt;/a&gt; CD&amp;rsquo;s and started tooling around again. I already had Vista installation on my work laptop, and did not want to blow that away, so I erred on the side of caution by not letting the Xubuntu setup program install its own GRUB bootloader&amp;hellip;except then I couldn&amp;rsquo;t get into the Linux OS&amp;hellip;&lt;/p&gt;

&lt;p&gt;So, off I go in search of GRUB install guides, and just about every how-to out there is using the basic scenario that GRUB was installed in the first place, and that it just needs to reinstall itself, which was totally not the case this time around!&lt;/p&gt;

&lt;p&gt;Anyway, after searching and searching and booting back and forth multiple times between Vista (slow boot!) and the Xubuntu live CD (which is somehow booting faster, even though it&amp;rsquo;s discovering all of the hardware for the first time), I finally stumbled across an absolute gem for Linux booting troubleshooting.&lt;/p&gt;

&lt;p&gt;I have to say this is by &lt;em&gt;FAR&lt;/em&gt; the most conclusive coverage I have EVER seen for resolving Linux boot issues. Lilo and GRUB issues are covered with tonnes of different scenarios, including dual-booting and the dreaded Vista BCD bootloader. If you have run just about ANY Linux distro, you need this reference. And don&amp;rsquo;t tell me that you&amp;rsquo;ve never had boot loader issues, &amp;lsquo;cuz it will happen to you!&lt;/p&gt;

&lt;p&gt;Check it out &lt;a href=&#34;http://www.justlinux.com/forum/showthread.php?s=7b4f3007a3173da87ba7e5683965a271&amp;amp;t=144294&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>